%script{:src => "//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js", :type => "text/javascript"}
%script{:src => "//google-maps-utility-library-v3.googlecode.com/svn/trunk/richmarker/src/richmarker-compiled.js", :type => "text/javascript"}
%script{:src => "//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js", :type => "text/javascript"}
.row
  .col-sm-12
    =render 'form'
.row
  .col-sm-12    
    #map{:style => "width: 800px; height: 400px;"}
    .legend
      = image_tag("dayhome-vonn.png", :alt => "Premium Private", :title => "Premium Private")
      Premium Private
      = image_tag("dayhome-private.png", :alt => "Private", :title => "Private")
      Private
      = image_tag("dayhome.png", :alt => "Private", :title => "Private")
      Accredited
  .col-sm-4{:style=>"float:right;"}
    %a{:href => "https://my.leadpages.net/leadbox/146cf0d73f72a2%3A1513729dbb46dc/5656058538229760/", :style => "color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.247059) 0px -1px 1px; box-shadow: rgba(255, 255, 255, 0.498039) 0px 1px 3px inset, rgba(0, 0, 0, 0.498039) 0px 1px 3px; background: rgb(255, 206, 10);", :target => "_blank"} Get our Free Childcare Search Checklist!
    %script{"data-config" => "%7B%7D", "data-leadbox" => "146cf0d73f72a2:1513729dbb46dc", "data-url" => "https://my.leadpages.net/leadbox/146cf0d73f72a2%3A1513729dbb46dc/5656058538229760/", :src => "//my.leadpages.net/leadbox-901.js", :type => "text/javascript"}
    %h3
      Sponsors
    .list
      =image_tag("landingpage/born2create.jpg", width: "232", alt: "Born2Create")    
  - if !@featured.empty?
    .col-sm-8
      .featured_listing
        .col-sm-12
          %h3
            Featured
          .featured{:style=>"margin:10px -10px -10px -10px;padding: 0 10px 10px 10px;"}
            =render :partial => 'day_home', :collection => @featured 

  .col-sm-8
    .col-sm-12
      %h3
        In your area
      <ul id="markers_list">  </ul>
    /
      - if !@day_homes.empty?
        =render :partial => 'day_home', :collection => @day_homes 
- content_for :scripts do
  = javascript_include_tag params[:controller]
  :javascript
    window.handler = {};
    window.markers = {};
    buildMap(#{raw @hash.to_json});
  :javascript
    var isMapDragging = false;
    var idleSkipped = false;
    var currentInfo = null;
    $(document).ready(function(){
      $(document).on('click',"#showSearchLink",function(){
        $('#showSearch').toggle();
        $('#hideSearch').toggle();
      });
      $(document).on('click',"#hideSearchLink",function(){
        $('#showSearch').toggle();
        $('#hideSearch').toggle();
      });
      //Add the center of the search?
      $(document).on('click',".markerCallout",function(){          
          var slug = $(this).attr('id');
          for(i=0;i<markers.length;i++){          
            var railsmarker = markers[i];
            //var marker = new google.maps.Marker({
            //  position: new google.maps.LatLng(railsmarker.lat,railsmarker.lng),
            // map: Gmaps.map.map              
            //});
            if (railsmarker.getServiceObject().title && railsmarker.getServiceObject().title.toString().indexOf(slug)>0) {              
              if(currentInfo != null){
                currentInfo.serviceObject.setIcon("/assets/dayhome.png");
                currentInfo['infowindow'].close();
              }
              currentInfo = railsmarker;
              try {
                railsmarker['infowindow'].open(handler.map,railsmarker.serviceObject);
                if(railsmarker.picture.indexOf("-featured")>0){
                  railsmarker.serviceObject.setIcon("/assets/dayhome-red-featured.png");
                }else {
                  railsmarker.serviceObject.setIcon("/assets/dayhome-red.png");
                }
              } catch (err) {
                 //wish I knew how to tell someone
              }
              window.handler.getMap().setZoom(7);
              window.handler.getMap().setCenter(railsmarker.serviceObject.position);
            }
          };
          $.scrollTo($('#map').position().top - ($(window).height() / 2),
            { speed: 'slow'}
          );
          return false;
      });
    });
    function _respondToMapChange(){
        $("#markers_list").children().remove();
        var j=0;
        var lasti=-1;
        var lastj=-1;
        for(i=0;i<window.markers.length;i++){
            if(window.handler.getMap().getBounds().contains(new google.maps.LatLng(window.markers[i].serviceObject.position.lat(),window.markers[i].serviceObject.position.lng()))){
              var m = $(window.markers[i].serviceObject.title);
              m.click(function(){
                window.handler.getMap().setZoom(4);
                window.handler.getMap().setCenter(window.markers[i].getPosition());
              });
              $("#markers_list").append(m);
              j++;
            }

            if(lasti!=i && lastj!=j && j>0 && j%5==0){
             $("#markers_list").append("<div class='dayhome_listing'><ins class='adsbygoogle' style='display:inline-block;width:234px;height:60px' data-ad-client='ca-pub-6835867491393885' data-ad-slot='3925033656'></ins></div"); 
             lasti=i;
             lastj=j;
            }
        }
    }
    
    